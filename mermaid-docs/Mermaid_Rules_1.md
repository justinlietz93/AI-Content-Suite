# Rewritten Narrative Report

**Generated on:** September 14, 2025 at 1:14 AM CDT

---

## Generated Narrative

This document establishes the definitive technical rules, syntax requirements, and constraints governing the Mermaid diagramming platform. Adherence to these mandates ensures precise rendering, consistent functionality, and effective validation across all Mermaid implementations.

---

## 1. Core Principles and Operational Requirements

### 1.1 General Principles
*   Files explicitly marked "AUTOGENERATED FILE. DO NOT EDIT." must not be modified directly. Source files require alteration.
*   Experimental diagram types and features (e.g., C4, Mindmap, Sankey, Timeline, Treemap, ZenUML, Radar, Architecture, Packet diagrams) exhibit syntax and properties subject to modification in future releases.
*   Mermaid does not support the Internet Explorer browser.

### 1.2 System and Environment Requirements for Rendering
*   **Node.js:** Installation of Node.js version 16 or newer is required for local rendering and validation.
*   **PNPM:** Installation of the `pnpm` package manager is required. Execute `pnpm env use --global 20` and reload shell configuration post-setup.
*   **Docker:** For Docker-based rendering, ensure Docker is installed. An X11 server must be operational on the host for GUI applications (e.g., Cypress) within Docker. Verify with `echo $DISPLAY`.
*   **Font Handling:** Mermaid necessitates complete page loading (DOM + assets, particularly font files) prior to rendering diagrams utilizing dynamically loaded CSS fonts. This prevents label misplacement. Specify fonts for `.mermaid` elements (e.g., `pre.mermaid { font-family: 'trebuchet ms', verdana, arial; }`) to ensure correct application.
*   **KaTeX/MathML:** External KaTeX stylesheets are mandatory when `legacyMathML` is enabled or for general MathML rendering.
*   **External Integrations:**
    *   **FontAwesome:** Integrate FontAwesome CSS on the host website or register icon packs via the Mermaid API for icon support.
    *   **ELK Layout:** For ELK layout application (e.g., ER Diagrams, Flowcharts), Mermaid version 9.4+ is required, with the ELK layout/renderer feature enabled in the lazy-loading configuration.
*   **Bug Fixes:** For resolution of actor/participant creation/deletion errors in Sequence diagrams, deploy Mermaid v10.7.0+.

## 2. Configuration and API Usage Directives

Mermaid configurations are applied hierarchically: Default < Site < Frontmatter < Directives (Deprecated).

### 2.1 Initialization
*   `mermaid.initialize(config)`: This function is applied once per page load, overriding default configurations at a site level. It *must* be invoked prior to `mermaid.run()`. Setting `mermaid.initialize({startOnLoad: false})` suppresses automatic `mermaid.run` execution post-page load.
*   **Deprecated:** `mermaid.startOnLoad` and `mermaid.htmlLabels` properties on the `mermaid` object are deprecated; use `mermaid.initialize()` for configuration.

### 2.2 Rendering Execution
*   `mermaid.run(options)`: Initiates diagram rendering.
    *   `querySelector`: `string` (default `".mermaid"`). Specifies target elements.
    *   `nodes`: `ArrayLike<HTMLElement>`. If provided, `querySelector` is ignored.
    *   `suppressErrors`: `boolean` (default `false`). If `true`, errors are logged but not thrown.
*   `bindFunctions()`: The method returned by `mermaid.render()` *must* be called after the SVG is inserted into the DOM to attach event listeners.

### 2.3 Syntax Parsing and Validation
*   `mermaid.parse(text, parseOptions)`: Validates diagram syntax without rendering.
    *   Returns `{ diagramType: string }` for valid syntax.
    *   Returns `false` if `parseOptions.suppressErrors` is `true` and syntax is invalid.
    *   Throws an error if `parseOptions.suppressErrors` is `false` or unset and syntax is invalid.
*   `mermaid.parseError`: This function can be overridden to customize parsing error handling. It is invoked when `parse()` throws an error, but not if `parseOptions.suppressErrors` is `true`.

### 2.4 Frontmatter Configuration (v10.5.0+)
*   Frontmatter is the recommended configuration method.
*   **Placement:** Must be a YAML block at the diagram definition's top.
*   **Delimiter:** The `---` (triple dash) on the first line *must* be the sole character on that line.
*   **Syntax:** Adhere to YAML syntax. Indentation must be consistent. Settings are case-sensitive.
*   **Error Handling:** Mermaid silently ignores misspelled frontmatter settings. Badly formed parameters will cause diagram breakage.

### 2.5 Directives (Deprecated in v10.5.0)
*   Directives are deprecated; transition to the `config` key within frontmatter.
*   **Syntax:** Enclosed in `%%{ }%%`.
*   **`init` Directive:** The JSON object argument to `init` directives *must* be valid, quoted JSON; otherwise, it will be ignored. Valid key-value pairs are defined in `defaultConfig.ts`. `init` and `initialize` keywords are interchangeable.
*   **Precedence:** `init` directives are processed before the graph/diagram description when deployed within code. Multiple `%%init%%` directives are grouped, with the last defined value for a setting taking precedence.

### 2.6 `MermaidConfig` Properties (Commonly Configured Options)
These properties are central to customizing Mermaid's rendering and behavior.
*   `arrowMarkerAbsolute`: `boolean`.
*   `darkMode`: `boolean`.
*   `deterministicIds`: `boolean`. Enables deterministic ID generation (using `deterministicIDSeed` or iterator) if `true`; `false` (default) uses random IDs.
*   `deterministicIDSeed`: `string`. Provides a static seed when `deterministicIds` is `true`.
*   `dompurifyConfig`: `Config` (from DOMPurify). Override with caution as it may disrupt Mermaid output.
*   `elk`: `object`. Configures ELK layout (e.g., `considerModelOrder`, `cycleBreakingStrategy`).
*   `fontFamily`: `string`. Any valid CSS `font-family` value.
*   `forceLegacyMathML`: `boolean`. Forces KaTeX's stylesheet for MathML, overriding `legacyMathML`. Recommended for consistent rendering.
*   `htmlLabels`: `boolean`.
*   `layout`: `string`. Valid values: `elk`, `tidy-tree`, `cose-bilkent`, `dagre`.
*   `legacyMathML`: `boolean`. If `true` and MathML is unsupported, Mermaid falls back to KaTeX. If `false` and MathML is unsupported, a warning replaces math equations.
*   `logLevel`: `0` (trace) to `5` (fatal errors only). Default: `5`.
*   `look`: `"classic"` | `"handDrawn"`.
*   `markdownAutoWrap`: `boolean`.
*   `maxEdges`: `number`. Maximum allowed edges in a graph.
*   `maxTextSize`: `number`. Maximum allowed size of the user's diagram text.
*   `startOnLoad`: `boolean`.
*   `suppressErrorRendering`: `boolean`. If `true`, 'Syntax error' diagrams are not inserted into the DOM.
*   `theme`: `"default"` | `"base"` | `"dark"` | `"forest"` | `"neutral"` | `"null"`.
*   `themeCSS`: `string`.
*   `themeVariables`: `any` object.
*   `wrap`: `boolean`.

### 2.7 Performance Considerations
*   Avoid redundant `getConfig()` invocations. Store the result in a variable and pass it to functions.

### 2.8 Icon Packs
*   Register icon packs via `mermaid.registerIconPacks(iconLoaders)`.
*   Use the `name` property during registration to override the Iconify pack prefix for shorter icon names.
*   Custom icons in architecture diagrams require the format `"name:icon-name"`.

## 3. Security and Interaction Directives

### 3.1 Security Level (`securityLevel`)
This configuration property governs the trust level for parsed diagrams, impacting content processing and interactivity.
*   `'strict'` (default): HTML tags are encoded, and click functionality (interaction, actor menus) is disabled.
*   `'antiscript'`: HTML tags are permitted (scripts removed), and click functionality is enabled.
*   `'loose'`: HTML tags are permitted, and click functionality is enabled.
*   `'sandbox'`: Rendering occurs within a sandboxed iframe, preventing JavaScript execution but potentially hindering interactive features. Source security is the site owner's responsibility when `securityLevel` is not `strict`.

### 3.2 Configuration Access and Mutability
*   Configurations provided via `init` directives cannot alter parameters specified in a higher-level `secure` array. Mermaid prioritizes `secure` array values in case of collision.
*   The `secure` array defines parameters immutable by `init` directives. Default immutable values: `'secure'`, `'securityLevel'`, `'startOnLoad'`, `'maxTextSize'`.
*   Site owners can extend the `secure` array using `mermaidAPI.initialize({..., secure: ['parameter1', 'parameter2']})`.
*   `setSiteConfig` values must exclude those in the `secure` array.
*   `setConfig` parameters are sanitized against `siteConfig.secure` keys; conflicting values are replaced by `siteConfig` values.
*   `reset()` and `globalReset()` functions are restricted to site owners.
*   `sanitize(options)` modifies options in-place to prevent overriding `siteConfig` secure keys.

### 3.3 Click Event Binding
*   **JavaScript Callback:**
    *   Syntax: `click <nodeId> <callbackFunctionName>` or `click <nodeId> call <callbackFunctionName>()`.
    *   The `callbackFunctionName` must be a JavaScript function defined on the page. It receives `nodeId` (or `taskId` for Gantt) as a parameter unless other arguments are explicitly specified for Gantt.
*   **URL Navigation:**
    *   Syntax: `click <nodeId> "<url>"` or `click <nodeId> href "<url>"`.
    *   Links default to opening in the same tab/window. Specify a link target (e.g., `_self`, `_blank`) within the click definition to alter this behavior.
*   **Tooltips:** Enclose tooltip text in double quotes.

### 3.4 Actor Menus (Sequence Diagrams)
*   **Simple Menu:** `link <actor>: <link-label> @ <link-url>`.
*   **Advanced JSON Menu:** `links <actor>: {"<link-name>": "<link-url>", ...}`.

## 4. Styling and Theming Directives

### 4.1 Styling Engine
*   The entry point for the styling engine is `src/styles.js`. The `getStyles` function within `src/styles.js` is invoked by Mermaid for style application.
*   **Color Representation:** The theming engine recognizes hex colors (e.g., `#ff0000`). Color names (e.g., `red`) are not supported, except for explicit `rgb()` or `rgba()` syntax for Sequence diagram `rect` blocks.

### 4.2 Theme Customization
*   Only the `base` theme is directly customizable.
*   Custom themes are created by modifying `themeVariables` via frontmatter configuration.
*   Color options and values are defined in `src/theme/theme-[xyz].js`.

### 4.3 Node and Link Styling
*   **Direct Styles:** Apply specific styles to a node or link using `style <nodeId> <styleList>` or `linkStyle <linkNumber> <styleList>`. Multiple nodes/links can be styled by listing their IDs/numbers.
*   **Style Classes:**
    *   Define reusable style classes with `classDef <className> <styleList>`. Multiple classes can be defined per `classDef`.
    *   Attach a class to a node/link using `class <nodeId> <className>` or `class <nodeId1>,<nodeId2> <className>`.
    *   Shorthand syntax: `nodeId:::className`. Multiple classes: `nodeId:::className1,className2`.
*   **Styling Priority:** Specific direct styles supersede class styles, which in turn supersede theme styles. A class named `default` applies to all nodes lacking specific class definitions; custom styles and specific classes override these defaults.

### 4.4 Styling Limitations
*   Notes and namespaces in Class diagrams do not support individual styling, though they respect themes.
*   The `:::` class shorthand cannot be used concurrently with a relation statement in Class diagrams.
*   `classDef` styles, when applied via `class` or `:::`, cannot target start/end states or states within composite states in Requirement or State diagrams.

### 4.5 Diagram-Specific Theme Variables
*   **GitGraph:** `git0` to `git7` for branch colors; `gitBranchLabel0` to `gitBranchLabel7` for branch label colors; `commitLabelColor`, `commitLabelBackground`, `commitLabelFontSize`, `tagLabelFontSize`, `tagLabelColor`, `tagLabelBackground`, `tagLabelBorder`; `gitInv0` to `gitInv7` for highlight commit colors. Supports up to 8 branches before cyclic color repetition.
*   **Radar:** Color scales `cScale${i}` for curves (where `i` is from 0 to the theme's maximum); specific options under the `radar` key within `themeVariables` (e.g., `radar: axisColor: "#FF0000"`).
*   **Timeline:** `cScale0` to `cScale11` for section/time-period background colors; `cScaleLabel0` to `cScaleLabel11` for foreground colors. Colors repeat after 12 sections.
*   **XY Chart:** Variables under the `xyChart` attribute (e.g., `xyChart: titleColor: '#ff0000'`). `plotColorPalette: '#color1, #color2, ...'` defines colors sequentially for lines and bars.

## 5. General Diagram Syntax and Formatting

### 5.1 Diagram Declaration
*   All diagram definitions *must* commence with a declaration of the diagram type (e.g., `flowchart`, `sequenceDiagram`), with the exception of Frontmatter configurations.

### 5.2 Comments
*   Comments *must* occupy their own line and be prefixed with `%%`. All text following `%%` to the next newline is considered a comment. Avoid curly braces (`{}`) within `%%` comments.
*   ZenUML diagrams utilize `// comment`. These comments render above messages or fragments and support Markdown.

### 5.3 Special Characters and Escaping
*   Enclose text containing problematic characters (e.g., parentheses, square brackets) in double quotes: `id1["This is the (text) in the box"]`.
*   Escape characters using HTML entity codes (e.g., `#9829;` for a heart). Entity code numbers are base 10 (e.g., `#35;` for `#`). HTML character names are also supported.
*   To embed a semicolon within Sequence diagram message text, use `#59;`.

### 5.4 Markdown Formatting
*   Bold text: double asterisks (`**`).
*   Italic text: single asterisks (`*`).
*   Line breaks: `\n` or `<br/>` within markdown strings, notes, and messages.
*   Unicode text is generally supported, often requiring enclosure in double quotes: `id["This ‚ù§ Unicode"]`.

### 5.5 Syntax Error Handling
*   Unknown words and misspellings within diagram definitions will cause diagram breakage.
*   Parameters in directives or frontmatter that are badly formed will silently fail or be ignored.
*   Detection of a keyword within unquoted user input in Requirement diagrams will result in a parser failure.

### 5.6 Mathematical Expressions (v10.9.0+)
*   Mathematical expressions *must* be delimited by `$$`.
*   Math rendering is currently supported exclusively for Flowcharts and Sequence diagrams.

### 5.7 Diagram Direction/Orientation
*   Many diagram types support a `direction` statement (e.g., `direction TB|BT|RL|LR`) to define their overall layout orientation. Supported values are diagram-specific.

## 6. Diagram-Specific Syntax and Behavior

This section details the precise syntax and operational rules for each supported Mermaid diagram type.

### 6.1 Architecture Diagrams (v11.1.0+)
*   **Declaration:** `architecture-beta`.
*   **Elements:** `groups`, `services`, `edges`, and `junctions` can be declared in any order. Identifiers *must* be declared prior to use.
*   **Icons:** Declare icons for supporting components by enclosing the icon name in `()`.
*   **Labels:** Declare labels for supporting components by enclosing text in `[]`.
*   **Syntax Reference:**
    *   Group: `group {group id}({icon name})[{title}] (in {parent id})?`
    *   Service: `service {service id}({icon name})[{title}] (in {parent id})?`
    *   Edge: `{serviceId}{{group}}?:{T|B|L|R} {<}?--{>}? {T|B|L|R}:{serviceId}{{group}}?`
    *   Junction: `junction {junction id} (in {parent id})?`
*   **Edge Rules:** Edge direction uses a colon (`:`) followed by `L|R|T|B` on the service side. Arrows are added by `_` (left) or `>` (right) before/after the direction. `groupIds` are not permitted for direct edge specification. The `{group}` modifier is exclusive to services within a group.

### 6.2 Block Diagrams
*   **Declaration:** `block`.
*   **Layout:** Columns are defined by `columns N`. Block width (column span) is `label:N`. Composite (nested) blocks use `block ... end`. Horizontal block arrangement requires `space` keywords. Vertical arrangement: `columns 1`. Space blocks: `space` (default 1 column) or `space:num`.
*   **Shapes:** Specific shapes are achieved by delimiters around text (e.g., `id("Text")` for round, `id[["Text"]]` for subroutine, `id(("Text"))` for circle).
*   **Arrows & Links:** Block arrows: `blockArrowId<["Label"]>(direction)`. Directions: `right`, `left`, `up`, `down`, `x`, `y`, `(x, down)`. Basic links: `A-->B` (arrow) or `A---B` (line). Text on links: `A-- "X" -->B`.

### 6.3 C4 Diagrams (Experimental)
*   **Declaration:** `C4Context`, `C4Container`, `C4Component`, `C4Dynamic`, or `C4Deployment`.
*   **Layout:** Not fully automated; shape positions are influenced by statement order. Layout statements `Lay_U`, `Lay_Up`, `Lay_D`, `Lay_Down`, `Lay_L`, `Lay_Left`, `Lay_R`, `Lay_Right` are not supported.
*   **Unsupported Features (Short-term):** `sprite`, `tags`, `link`, `Legend`.
*   `RelIndex` ignores its index parameter; sequence is determined by `rel` statement order.
*   Parameter assignment for styles can be non-named (order-based) or named (prefix with `$`, e.g., `$offsetX`).

### 6.4 Class Diagrams
*   **Declaration:** `classDiagram`.
*   **Naming:** Class names: alphanumeric (including unicode), underscores, dashes (`-`). Labels can be in `["Label"]` or `` `Label` ``. Generic types are not part of the class name for referencing. Duplicate class names with different generic types are unsupported.
*   **Members:** Defined using a colon `:` (single) or curly braces `{}` (multiple). Method return types require a space between `)` and the type.
*   **Generics:** Enclosed in `~`. Nested generics are supported. Generics containing commas (e.g., `List<K, V>`) are unsupported.
*   **Visibility & Classifiers:**
    *   Visibility: `+` (Public), `-` (Private), `#` (Protected), `~` (Package/Internal) precede the member name.
    *   Method Classifiers: `*` (Abstract), `$` (Static) appended after `()` or return type.
    *   Field Classifiers: `$` (Static) appended at the end of the field definition.
*   **Relationships:** `[classA][Arrow][ClassB]`. Arrow types: `<\|--`, `*--`, `o--`, `-->`, `--`, `..<`, `..\|>`, `..`. Arrowheads can be reversed. Labels on relations: `[classA][Arrow][ClassB]:LabelText`. Two-way relations: `[Relation Type][Link][Relation Type]`. Cardinality: quoted text `"1"` or `"*"` before/after an arrow.
*   **Interfaces & Namespaces:** Lollipop interfaces: `bar ()-- foo`. Each interface must be unique. Namespaces: `namespace Name { ... }`.
*   **Annotations:** `<<Interface>>`, `<<Abstract>>`, `<<Service>>`, `<<Enumeration>>` defined within `<<` and `>>`. Inline style `class Name <<Annotation>>` is recommended.
*   **Notes:** General `note "text"` or class-specific `note for ClassName "text"`.
*   **Configuration:** `hideEmptyMembersBox` is configurable.

### 6.5 Entity Relationship Diagrams
*   **Declaration:** `erDiagram`.
*   **Entity Naming:** Singular nouns. Unicode and spaces (in double quotes) allowed. Aliases: `name[Alias]`.
*   **Relationships:** `<first-entity> [<relationship> <second-entity> : <relationship-label>]`. All parts mandatory if specified beyond `<first-entity>`. `relationship-label` describes relation from first entity's perspective. Unicode/Markdown supported.
    *   Cardinality: `\|o`, `o\|` (Zero or one); `\|\|`, `\|\|` (Exactly one); `}o`, `o{` (Zero or more); `}\|`, `\|{` (One or more).
    *   Identifying: `--` (solid). Non-identifying: `..` (dashed).
*   **Attributes:** Defined in a block `{ type name }`. `type` must begin with an alphabetic char, `name` can start with `*` for primary key. No implicit valid data types.
*   **Attribute Keys & Comments:** `PK` (Primary Key), `FK` (Foreign Key), `UK` (Unique Key). Multiple keys: `PK, FK`. No Markdown/Unicode for keys. Comments: `""` at end of definition; cannot contain `"` character.
*   **Configuration:** ELK layout: `config: layout: elk` in frontmatter.

### 6.6 Flowchart Diagrams
*   **Declaration:** `flowchart` or `graph`.
*   **Node Naming Constraints:** "end" (lowercase) as a node name will break; capitalize or enclose. "o" or "x" as first letter of connecting node: add space or capitalize. "Nodes inside nodes" require quotes.
*   **Nodes:** ID (default text) or `id1[Text in the box]`. Markdown text: `markdown["\`This **is** _Markdown_\`"]`.
*   **Node Shapes:** Delimiters define shapes (e.g., `id1(Text)` for round, `id1[[Text]]` for subroutine, `id1((Text))` for circle, `id1>Text]` for asymmetric). General syntax: `A@{ shape: <shapeName> }`. Asymmetric `id1>Text]` lacks mirror support.
*   **Special Shapes (Icons/Images):**
    *   Icon: `A@{ icon: "<iconName>", form: "<shape>", label: "Text", pos: "<position>", h: <height> }`. Defaults: `label` not displayed, `pos` to `b`, `h` to `48`. Minimum `h`: `48`. FontAwesome icons: `fa:<icon class name>`.
    *   Image: `A@{ img: "<url>", label: "Text", pos: "<position>", w: <width>, h: <height>, constraint: "<on|off>" }`. Defaults: `label` not displayed, `pos` to `b`, `w`/`h` to natural size, `constraint` to `off`. `constraint: on` maintains aspect ratio.
*   **Links/Edges:** Solid/dotted lines (`-`, `--`), with/without arrowheads (`>`, `>>`), crosses (`x`), circles (`o`), invisible (`~~~`). Text: `A -- Text --> B` or `A -->|Text|B`. Multi-directional: `A o--o B`.
*   **Link Chaining:** `A -- text --> B -- text2 --> C`. Multiple node links: `a --> b & c--> d`. Parallel links: `A & B --> C & D`.
*   **Edge IDs & Animation:** Assign ID: `A <edgeId>@--> B`. Animate: `<edgeId>@{ animate: true }`. Speed: `<edgeId>@{ animation: <speed> }` (`fast`, `slow`). Escape commas in `stroke-dasharray` as `\,`.
*   **Minimum Link Length:** Extra dashes (`-`), equals (`=`), or dots (`.`). Extra characters on right for links with labels.
*   **Subgraphs:** `subgraph <title> \n ... \n end`. Explicit ID: `subgraph <id> [<title>] \n ... \n end`. `direction` statement within `flowchart` subgraphs. Subgraph direction ignored if linked externally; inherits parent.
*   **Graph Declarations:** Optional semicolon. Single space between vertices/link: `A --- B`. No space between vertex/text: `A[Text]`. No space between link/text: `A--Text-->B`.
*   **Configuration:** `config: flowchart: markdownAutoWrap: false`. ELK renderer: `config: flowchart: defaultRenderer: "elk"`. Diagram-level curve style: `config: flowchart: curve: <curveStyle>`. Values: `basis`, `bumpX`, `bumpY`, `cardinal`, `catmullRom`, `linear`, `monotoneX`, `monotoneY`, `natural`, `step`, `stepAfter`, `stepBefore`. Edge-level curve styles override diagram-level. Last modification applies.

### 6.7 Gantt Diagram
*   **Declaration:** `gantt`.
*   **Title:** `title <text>` (optional).
*   **Date Formatting:** `dateFormat <format>` (default `YYYY-MM-DD`). `axisFormat <format>` (default `YYYY-MM-DD`). Refer to `day.js` and `d3-time-format` docs.
*   **Excludes & Weekends:** `excludes <dates>` (e.g., `YYYY-MM-DD`, "sunday", "weekends"). "weekdays" unsupported. `weekend <day>` (v11.0.0+) for custom weekend start (`friday`, `saturday`). Default weekend: Sat/Sun.
*   **Sections:** `section <name>`. Required name. Tasks follow current section.
*   **Tasks:** `title:metadata`. Metadata: comma-separated. Tags (`active`, `done`, `crit`, `milestone`) must be first. `until` keyword for end dates (v10.9.0+). Sequential by default; start date defaults to preceding task's end.
*   **Milestones:** `milestone` keyword in metadata. Position: `initial date + duration / 2`.
*   **Vertical Markers:** `vert` keyword in metadata. Extend across chart, positioned by date, do not take a row.
*   **Axis Ticks (v10.3.0+):** `tickInterval <interval>`. Pattern: `^([1-9][0-9]*)(millisecond|second|minute|hour|day|week|month)$`. `millisecond`/`second` require v10.3.0+. `weekday <day>` for week-based `tickInterval` (default Sunday).
*   **Task Duration:** Tasks are continuous bars. Excluded dates extend duration to the right, no gaps within task. Excluded dates between tasks are skipped graphically.
*   **Today Marker:** `todayMarker <styleList>` or `todayMarker off`.
*   **Configuration:** Compact mode: `displayMode: compact` in frontmatter. Margins: `mermaid.ganttConfig` or CLI JSON.

### 6.8 GitGraph Diagrams
*   **Declaration:** `gitGraph`.
*   **Initialization:** Default `main` branch (current). Commits have unique, random IDs by default.
*   **Commits:** `commit`. Default type `NORMAL`. Custom ID: `id: "<your_custom_id>"`. Type: `type: <NORMAL|REVERSE|HIGHLIGHT>`. Tag: `tag: "<your_custom_tag>"`. Attributes can be mixed.
*   **Branches:** Create/switch: `branch <branchName>`. Name must be unique. Switch: `checkout <branchName>` (`switch` interchangeable). Non-existent branch checkout is console error. Merge: `merge <branchName>`. Only separate branches can merge. Results in merge commit (filled double circle). Cherry-pick: `cherry-pick id:"<commitId>"` (v10.8.0+). `id` required, commit must not be on current branch. Current branch needs at least one commit. Cherry-picking merge commit requires `parent:"<commitId>"`. Invalid parent throws error. Parent must be immediate.
*   **Merge Decoration:** Decorate merge commits using `id`, `tag`, `type` (e.g., `merge develop id: "customID" tag: "customTag" type: REVERSE`).
*   **Branch Order:** `order: <positiveNumber>`. `main` branch default `0`. Branches without `order` appear by appearance. Define `order` for all branches for full control.
*   **Keywords as Branch Names:** Quote if ambiguous (e.g., `"cherry-pick"`).
*   **Orientation (v10.3.0+):** `gitGraph LR:` (Left-to-Right, default), `gitGraph TB:` (Top-to-Bottom), `gitGraph BT:` (Bottom-to-Top, v11.0.0+).
*   **Configuration:** `showBranches`: `boolean` (default `true`). `showCommitLabel`: `boolean` (default `true`). `rotateCommitLabel`: `boolean` (default `true`). `mainBranchName`: `string` (default `main`). `mainBranchOrder`: `integer` (default `0`). `parallelCommits`: `boolean` (default `false`).

### 6.9 Kanban Diagram
*   **Declaration:** `kanban`.
*   **Columns:** `columnId[Column Title]`. Represent workflow stages.
*   **Tasks:** Listed under columns with indentation (crucial). `taskId[Task Description]`. Each column/task needs unique ID. Metadata: `@{'key': 'value', ...}`. Keys: `assigned`, `ticket`, `priority`. `priority` values: `'Very High'`, `'High'`, `'Low'`, `'Very Low'`.
*   **Configuration:** Ticket base URL: `config: kanban: ticketBaseUrl: 'URL'` in frontmatter. `#TICKET#` is replaced by task ticket value.

### 6.10 Mindmap Diagrams
*   **Declaration:** `mindmap`.
*   **Hierarchy:** Defined by indentation (spaces/tabs). Indentation relative to nearest parent.
*   **Node Shapes:** Square: `id[Text]`. Rounded square: `id(Text)`. Circle: `id((Text))`. Bang: `id))Text((`. Cloud: `id)Text(`. Hexagon: `id{{Text}}`. Default: `Text` (no delimiters).
*   **Icons:** `::icon(<iconClasses>)` (e.g., `::icon(fa fa-book)`).
*   **Configuration:** Tidy Tree layout: `config: layout: tidy-tree` in frontmatter.

### 6.11 Packet Diagram (v11.0.0+)
*   **Declaration:** `packet`.
*   **Fields:** Multi-bit blocks: `start-end: "Block name"`. Single-bit blocks: `start: "Block name"`. Bit count fields: `+<count>: "Block name"` (v11.7.0+, starts from end of previous field). Each line is a field. Descriptions in quotes.

### 6.12 Pie Chart Diagrams
*   **Declaration:** `pie`.
*   **Title:** `title <titleValue>` (optional string).
*   **Data Set:** Pie slices: `"<label>" : <numericValue>`. Ordered clockwise. Numeric values up to two decimal places. Must be positive, greater than zero. Negative values cause error.
*   **Display Options:** `showData` renders data values with legend text.
*   **Configuration:** Axial position of labels (`textPosition`) from `0.0` (center) to `1.0` (outside). Default `0.75`.

### 6.13 Quadrant Chart
*   **Declaration:** `quadrantChart`.
*   **Title:** `title <text>` (always at top).
*   **Axes:** X-axis: `x-axis <leftText> --> <rightText>` or `x-axis <leftText>`. Y-axis: `y-axis <bottomText> --> <topText>` or `y-axis <bottomText>`. If no points, axis/quadrant text center in quadrants. If points, x-axis labels are left of quadrant/bottom of chart; y-axis labels are bottom of quadrant.
*   **Quadrant Text:** `quadrant-[1|2|3|4] <text>`. If points, text renders at top of quadrant.
*   **Points:** `<pointLabel>: [<xValue>, <yValue>]`. X/Y values `0` to `1`.
*   **Point Styling:** Direct styles (e.g., `radius: 12, color: #ff3300`) or class styles (e.g., `Point A:::class1: [0.9, 0.0]`). Direct > Class > Theme.

### 6.14 Radar Diagram (v11.6.0+)
*   **Declaration:** `radar-beta`.
*   **Title:** `title <text>` (optional).
*   **Axes:** `axis <id>["<label>"][, <id>["<label>"]...]`. Multiple axes per line.
*   **Curves:** `curve <id>["<label>"]{<value1>, <value2>, ...}` (list) or `curve <id>["<label>"]{<axisId1>: <value1>, ...}` (key-value pairs). Multiple curves per line. List assumes axis order.
*   **Options:** `showLegend <true|false>` (default `true`). `max <value>` (calculated if not provided). `min <value>` (default `0`). `graticule <circle|polygon>` (default `circle`). `ticks <number>` (default `5`).

### 6.15 Requirement Diagram
*   **Declaration:** `requirementDiagram`.
*   **Input:** User input (names, text) can be quoted.
*   **Requirement Definition:** `<type> <user_defined_name> { id: <user_defined_id> text: <user_defined_text> risk: <risk> verifymethod: <method> }`.
    *   Types: `requirement`, `functionalRequirement`, `interfaceRequirement`, `performanceRequirement`, `physicalRequirement`, `designConstraint`.
    *   Risk: `Low`, `Medium`, `High`.
    *   Verification: `Analysis`, `Inspection`, `Test`, `Demonstration`.
*   **Element Definition:** `element <user_defined_name> { type: <user_defined_type> docref: <user_defined_ref> }`.
*   **Relationship:** `{source} - <type> -> {destination}` or `{destination} <- <type> - {source}`.
    *   Types: `contains`, `copies`, `derives`, `satisfies`, `verifies`, `refines`, `traces`.
    *   Source/destination names must refer to existing requirement/element nodes.

### 6.16 Sankey Diagram (v10.3.0+)
*   **Declaration:** `sankey`.
*   **CSV Data:** Exactly 3 columns: `source`, `target`, `value`. Empty lines allowed. Comma in field: wrap in quotes. Double quote in quoted string: `""`.
*   **Configuration:** `linkColor`: `source`, `target`, `gradient`, or hex code. `nodeAlignment`: `justify`, `center`, `left`, `right`.

### 6.17 Sequence Diagrams
*   **Declaration:** `sequenceDiagram`.
*   **Node Naming Constraints:** "end" (lowercase) as node name is problematic; enclose or capitalize.
*   **Participants:** Implicit or `participant <name>`. Actor symbol: `actor <name>`. Specific symbols: `participant <name> @{ "type" : "<symbolType>" }` (`boundary`, `control`, `entity`, `database`, `collections`, `queue`). Aliases: `participant <alias> as <label>`. Line breaks in actor names use `aliases` with `<br/>`.
*   **Actor Creation/Destruction (v10.3.0+):** `create participant <name>` or `create actor <alias> as <label>`. Only message recipient can be created. `destroy <name>`. Sender or recipient can be destroyed.
*   **Grouping (Boxes):** `box <colorOrDescription> <actor1> & <actor2> ... end`. Transparent box: `box transparent <colorName>`.
*   **Messages:** `[Actor][Arrow][Actor]:Message text`.
    *   Arrows: `->` (solid, no arrow), `-->` (dotted, no arrow), `->>` (solid, arrowhead), `-->>` (dotted, arrowhead), `<<->>` (solid bidirectional, v11.0.0+), `<<-->>` (dotted bidirectional, v11.0.0+), `-x` (solid, cross), `--x` (dotted, cross), `-)` (solid, open async), `--)` (dotted, open async).
*   **Activations:** `activate <actor>`, `deactivate <actor>`. Shorthand: `->>+<actor>` (activate recipient), `-->>-<actor>` (deactivate sender).
*   **Notes:** `Note right of <actor>: <text>`. Spanning: `Note over <actor1>,<actor2>: <text>`.
*   **Combined Fragments:**
    *   Loop: `loop <text> \n ... \n end`.
    *   Alternative: `alt <desc> \n ... \n else \n ... \n end`. Optional: `opt <desc> \n ... \n end`.
    *   Parallel: `par [Action 1] \n ... \n and [Action 2] \n ... \n end`.
    *   Critical: `critical [Action] \n ... \n option [Circumstance A] \n ... \n end`.
    *   Break: `break [reason] \n ... \n end`.
*   **Background Highlighting:** `rect <COLOR> \n ...content... \n end`. Colors use `rgb()` or `rgba()`.
*   **Sequence Numbers:** `autonumber` keyword or `mermaid.initialize({ sequence: { showSequenceNumbers: true } })`.
*   **Configuration:** Margins: `mermaid.sequenceConfig` or CLI JSON. For actor/participant creation/deletion bug fixes, update to v10.7.0+.

### 6.18 State Diagrams
*   **Declaration:** `stateDiagram-v2` (recommended) or `stateDiagram`.
*   **States:** ID: `stateId`. Description and alias: `state "Description" as s2`. Description with colon: `s2 : Description`. Spaces in name: define with ID, then reference (e.g., `yswsii: Your state with spaces in it`).
*   **Transitions:** `s1 --> s2`. Text: `s1 --> s2: A transition`. Undefined states are implicitly defined.
*   **Start/End States:** `[*]`. Transition direction defines type.
*   **Composite States:** `state <id> { \n ...internal... \n }`. Name on separate line: `CompositeName: Description`. Transitions not permitted between internal states of different composite states.
*   **Special States:** Choice: `state <id> <<choice>>`. Fork: `state <id> <<fork>>`. Join: `state <id> <<join>>`.
*   **Notes:** Multiline: `note <position> of <stateId> \n <text> \n end note`. Single-line: `note <position> of <stateId> : <text>`. Position: `right` or `left`.
*   **Concurrency:** `--` within composite state.

### 6.19 Timeline Diagram
*   **Declaration:** `timeline`.
*   **Title:** `title <titleText>` (optional).
*   **Events:** `timePeriod : eventText`. Multiple events on one line: `timePeriod : eventText1 : eventText2`. Multiple events on separate lines: `timePeriod : eventText1 \n : eventText2`. Time period and event text are not limited to numbers. Sequence matters: left-to-right for time periods, top-to-bottom for events within a period.
*   **Sections/Grouping:** `section <sectionName>`. All subsequent time periods in this section. Default section if none defined. Follows color scheme.
*   **Text Wrapping:** `<br>` forces line break. Automatic wrapping occurs if text is too long.
*   **Styling:** If no section, time periods are styled individually. `disableMulticolor: true` for single color scheme.

### 6.20 Treemap Diagram
*   **Declaration:** `treemap-beta`.
*   **Nodes:** Section/parent nodes: `"Section Name"`. Leaf nodes with values: `"Leaf Name": <value>`.
*   **Hierarchy:** Indentation (spaces/tabs).
*   **Value Display:** `showValues` defaults to `true`.
*   **Configuration:** Diagram padding: `diagramPadding`. Value format: `valueFormat` (uses D3 format specifiers, e.g., `,`, `$`, `.1f`).
*   **Limitations:** Best suited for hierarchical data. Very small values may be difficult to visualize. Deep hierarchies can be unclear. Not suitable for negative values.

### 6.21 User Journey Diagram
*   **Declaration:** `journey`.
*   **Title:** `title <titleText>` (optional).
*   **Sections:** `section <sectionName>`.
*   **Tasks:** `Task name: <score>: <comma separated list of actors>`.

### 6.22 XY Chart
*   **Declaration:** `xychart`.
*   **Orientation:** `xychart horizontal` or `xychart vertical` (default).
*   **Title:** `title "<titleText>"`.
*   **Text Values:** Multiple words (especially with spaces) *must* be in double quotes. Single words can omit quotes.
*   **Axes:** Numeric x-axis: `x-axis <title> <min> --> <max>`. Categorical x-axis: `x-axis "<title>" [<category1>, "<category2>", ...]`. Numeric y-axis: `y-axis "<title>" <min> --> <max>`. Y-axis title only: `y-axis "<title>"`. Axes are optional; range auto-generated if omitted.
*   **Data Series:** Line series: `line [<value1>, <value2>, ...]`. Bar series: `bar [<value1>, <value2>, ...]`. Values are numeric.
*   **Minimum Requirements:** Chart name (`xychart`) and at least one data set (`line` or `bar`).
*   **Configuration:** Show data values in bars: `showDataLabel: true` (default `false`).

### 6.23 ZenUML Diagrams
*   **Declaration:** `zenuml`.
*   **Participants:** Implicit or explicit `<name>`. Symbols: `@Actor Alice`, `@Database Bob`. Aliases: `A as Alice`.
*   **Messages:**
    *   Sync: `A.SyncMessage`. With parameters/nesting: `A.SyncMessage(with, parameters) { \n B.nestedSyncMessage() \n }`.
    *   Async: `Alice->Bob: How are you?`.
    *   Creation: `new A1` or `new A2(with, parameters)`.
    *   Reply: Variable assignment from sync: `a = A.SyncMessage()`. Typed variable: `SomeType a = A.SyncMessage()`. `return` keyword within method. `@return` or `@reply` annotator for async.
*   **Nesting:** Sync messages and creation messages nested using `{}`.
*   **Combined Fragments:**
    *   Loops: `while(<condition>) { ... }`. Keywords: `for`, `forEach`, `foreach`, `loop`.
    *   Alternatives: `if(<condition1>) { ... } else if(<condition2>) { ... } else { ... }`.
    *   Optional: `opt { ... }`.
    *   Parallel: `par { \n statement1 \n statement2 \n }`.
    *   Try/Catch/Finally (Break): `try { ... } catch { ... } finally { ... }`.

## 7. File Management Directives
*   Applications supporting Mermaid files *should* use `.mermaid` or `.mmd` file extensions.
*   The recommended MIME type for Mermaid media is `text/vnd.mermaid`.

---

*Powered by AI Content Suite & Gemini*
